# 종목 발굴 시스템 (Stock Discovery)

- **날짜**: 2026-01-28
- **이슈**: #6, #10-17
- **브랜치**: `feature/issue10`
- **상태**: 완료

## 목표

퀀트 조건 기반 종목 스크리닝 및 매수 신호 생성 시스템 구축

## 배경

- 현재 스크리닝 코드가 분산되어 있음
- 조건 정의, 평가, 결과 저장이 체계화되지 않음
- 관심종목 관리 기능 부재

## 이슈 의존성

```
#10 Schema Design ─────┐
                       ├──► #12 Condition Evaluation ──┐
#11 Price Data ────────┘                               │
       │                                               ├──► #16 Buy Decision
       └──► #14 Technical Indicators ──────────────────┤
                                                       │
#15 News Feed (optional) ──────────────────────────────┘

#13 Watchlist ──► (독립)
#17 Price Targets ──► (독립)
```

## 계획

### Phase 1: 기반 구축
- [x] **#10** Quant Condition Schema Design
  - 조건 타입 Enum (MA_TOUCH, RSI_RANGE, VOLUME_SPIKE 등)
  - 조건 파라미터 스키마
  - 조건 조합 로직 (AND/OR)
- [x] **#11** Single Stock Price Data Fetching
  - 기존 `utils/fetch.py` 확장
  - 캐싱 레이어 추가
- [x] **#13** Manual Watchlist Registration
  - `config/watchlist.yaml` 저장
  - 태그/메모 지원

### Phase 2: 조건 평가
- [x] **#12** Single Quant Condition Evaluation
  - MA 터치 조건 평가
  - 결과 상세 정보 반환
- [x] **#14** Technical Indicators Calculation
  - RSI, MACD, Bollinger Bands
  - 이동평균선 (5, 20, 60, 120, 240일)

### Phase 3: 매수 결정
- [x] **#17** Price Target Settings
  - 매수가, 매도가, 손절가, 익절가 설정
  - `config/price_targets.yaml` 저장
- [x] **#16** Buy Decision Logic
  - 지표 기반 점수화
  - 최종 매수 추천 (STRONG_BUY, BUY, HOLD, WAIT)

### Phase 4: 확장 (선택)
- [ ] **#15** News Feed Integration (API 키 필요) - 생략
  - 뉴스 API 연동
  - 감성 분석

## 변경 파일

### 신규 생성

| 파일 | 설명 |
|------|------|
| `models/condition.py` | 퀀트 조건 스키마 |
| `models/watchlist.py` | 관심종목 모델 |
| `models/price_target.py` | 목표가 모델 |
| `discovery/evaluator.py` | 조건 평가기 |
| `discovery/indicators.py` | 기술적 지표 계산 |
| `discovery/decision.py` | 매수 결정 로직 |
| `config/watchlist.yaml` | 관심종목 저장 |
| `config/price_targets.yaml` | 목표가 저장 |

### 수정

| 파일 | 변경 내용 |
|------|----------|
| `utils/fetch.py` | 캐싱 레이어 추가 |

## 기술적 고려사항

### 데이터 클래스
- Pydantic 또는 dataclasses 사용
- YAML 직렬화 지원

### 기존 코드 활용
- `utils/fetch.py` - 가격 데이터 조회
- `screener/korean/ma_screener.py` - MA 계산 참고
- `screener/technical_filter.py` - 기술적 필터 참고

### Acceptance Criteria 요약

**#10 Schema:**
```python
condition = Condition(type=ConditionType.MA_TOUCH, params={"period": 240})
```

**#12 Evaluation:**
```python
result = evaluate_condition(ticker="005930", condition=condition)
assert result.matched in [True, False]
```

**#16 Decision:**
```python
decision = analyze_buy_signal("005930")
assert decision.recommendation in ["STRONG_BUY", "BUY", "HOLD", "WAIT"]
```

## 결과

### 구현 완료 (2026-01-28)

**커밋**: `8ae8363`

**생성된 모듈:**

| 모듈 | 파일 | 설명 |
|------|------|------|
| `models` | `condition.py` | 17개 조건 타입, AND/OR 조합 지원 |
| `models` | `watchlist.py` | YAML 기반 관심종목 관리 |
| `models` | `price_target.py` | 목표가 설정 및 알림 체크 |
| `discovery` | `evaluator.py` | 조건 평가 엔진 |
| `discovery` | `indicators.py` | RSI, MACD, BB, MA 계산 |
| `discovery` | `decision.py` | 매수 결정 로직 (점수화) |

**사용 예시:**
```python
# 매수 신호 분석
from discovery import analyze_buy_signal

decision = analyze_buy_signal("005930.KS")
print(decision.summary())
# → Recommendation: HOLD, Score: 54/100, Risk: HIGH

# 관심종목 관리
from models import Watchlist

watchlist = Watchlist()
watchlist.add("AAPL", note="Tech giant", tags=["tech", "dividend"])

# 목표가 설정
from models import PriceTargets

targets = PriceTargets()
targets.set("AAPL", buy=180, stop_loss=170, take_profit=200)
```

**종료된 이슈:** #6, #10, #11, #12, #13, #14, #16, #17
